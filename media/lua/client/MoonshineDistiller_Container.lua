--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]



MoonshineDistillery = MoonshineDistillery or {}




-----------------------            ---------------------------
function MoonshineDistillery.getDrainPortContainer(sq)
   if not sq then return nil end
   local spr = sq:getSpriteName()

   local offset = {
      ["MoonshineDistillery_16"] = {1, -1}, -- DrainPort at (x+1, y-1)
      ["MoonshineDistillery_27"] = {-1, 1}  -- DrainPort at (x-1, y+1)
   }

   local dx, dy = offset[spr] and table.unpack(offset[spr]) or nil
   if not dx then return nil end

   local drainPortSquare = getCell():getGridSquare(sq:getX() + dx, sq:getY() + dy, sq:getZ())
   if not drainPortSquare then return nil end

   for i = 0, drainPortSquare:getObjects():size() - 1 do
      local obj = drainPortSquare:getObjects():get(i)
      if obj:getSpriteName() == "MoonshineDistillery_22" or obj:getSpriteName() == "MoonshineDistillery_30" then
         return obj:getContainer()
      end
   end

   return nil
end
function MoonshineDistillery.isCompleteParts(obj)
   if not obj then return false end
   local spr = obj:getSprite()
   local sprName = spr and spr:getName() or nil

   if not MoonshineDistillery.isBoilerTile(sprName) then return false end

   local offsets = {
      ["MoonshineDistillery_16"] = {
         {0, 0, "MoonshineDistillery_20"}, -- StillCap
         {0, 0, "MoonshineDistillery_21"}, -- Thermometer
         {1, -1, "MoonshineDistillery_22"} -- DrainPort
      },
      ["MoonshineDistillery_27"] = {
         {0, 0, "MoonshineDistillery_28"}, -- StillCap
         {0, 0, "MoonshineDistillery_29"}, -- Thermometer
         {-1, 1, "MoonshineDistillery_30"} -- DrainPort
      }
   }

   local parts = offsets[sprName]
   if not parts then return false end

   local sq = obj:getSquare()
   if not sq then return false end

   for i = 1, #parts do
      local px, py, expectedSpr = unpack(parts[i])
      local partSquare = getCell():getGridSquare(sq:getX() + px, sq:getY() + py, sq:getZ())
      if not partSquare then return false end

      local found = false
      for j = 0, partSquare:getObjects():size() - 1 do
         if partSquare:getObjects():get(j):getSpriteName() == expectedSpr then
            found = true
            break
         end
      end

      if not found then return false end
   end

   return true
end


--[[
function MoonshineDistillery.isCompleteParts(sq)
    if not sq then return false end
    local spr = sq:getSpriteName()

    local offsets = {
        ["MoonshineDistillery_16"] = {
            {0, 0, "MoonshineDistillery_20"}, -- StillCap
            {0, 0, "MoonshineDistillery_21"}, -- Thermometer
            {1, -1, "MoonshineDistillery_22"} -- DrainPort
        },
        ["MoonshineDistillery_27"] = {
            {0, 0, "MoonshineDistillery_28"}, -- StillCap
            {0, 0, "MoonshineDistillery_29"}, -- Thermometer
            {-1, 1, "MoonshineDistillery_30"} -- DrainPort
        }
    }

    local parts = offsets[spr]
    if not parts then return false end

    for _, part in ipairs(parts) do
        local px, py, expectedSpr = table.unpack(part)
        local partSquare = getCell():getGridSquare(sq:getX() + px, sq:getY() + py, sq:getZ())
        if not partSquare then return false end

        local found = false
        for i = 0, partSquare:getObjects():size() - 1 do
            if partSquare:getObjects():get(i):getSpriteName() == expectedSpr then
                found = true
                break
            end
        end

        if not found then return false end
    end

    return true
end
 ]]
--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]



MoonshineDistillery = MoonshineDistillery or {}
--[[
function MoonshineDistillery.doRoll()
    local chance = SandboxVars.Moonshine.DeadlyBatchChance
    if chance == 0 then return false end
    if chance == 100 then return true end
    return percent >= ZombRand(1, 101)
end


function MoonshineDistillery.getWaitPeriod()
    local period = SandboxVars.Moonshine.WaitPeriod
    return period or 4
end


function MoonshineDistillery.getYield(obj)
    local pl = getPlayer()
    if not obj then return end
    local safeLvl = SandboxVars.Moonshine.SafeBatchLevel
    local lvl = pl:getPerkLevel(Perks.Cooking)
    local roll = MoonshineDistillery.doRoll()
    local cont = obj:getContainer()
    local contInv = cont and cont:getItems()

    local min = SandboxVars.Moonshine.MinPossibleYield or 0
    local max = SandboxVars.Moonshine.MaxPossibleYield or 6
    local bonus = SandboxVars.Moonshine.CookLevelBonus or true
    local yield = ZombRand(min, max+1)
    local item = "Base.Moonshine"
    if bonus then
        yield = yield + lvl
    end
    if lvl <= safeLvl and roll then
        item = "Base.DeadlyMoonshine"
    end
    if yield > 0 then
        cont:AddItems(item, yield)
    end

    cont:setDrawDirty(true);

end

 ]]
function MoonshineDistillery.delItem(cont, fType, qty)
    qty = qty or 1
    local count = cont:getItemCount(fType)
    --local count = item:getContainer():getNumberOfItem(fType)
    if count >= qty then
        for i=1, qty do
            local item = contInv:FindAndReturn(fType)
            if item then
                if isClient() then
                    cont:removeItemOnServer(item)
                end
                cont:DoRemoveItem(item)
            end
        end
        getPlayerLoot(0):refreshBackpacks()
    end
end

-----------------------            ---------------------------


function MoonshineDistillery.getStageSpr(var)
    local tab = {
        1 = "MoonshineDistillery_0",
        2 = "MoonshineDistillery_1",
        3 = "MoonshineDistillery_2",
        4 = "MoonshineDistillery_3",
        5 = "MoonshineDistillery_4",
    }
    if type(var) == "string" then
        tab = {
            ["empty"] = "MoonshineDistillery_0",
            ["water"] = "MoonshineDistillery_1",
            ["mash"] = "MoonshineDistillery_2",
            ["unfermented"] = "MoonshineDistillery_3",
            ["cooking"] = "MoonshineDistillery_4",
        }
    end
    return tab[var]
end
function MoonshineDistillery.setStage(obj, var)
    local sprName = MoonshineDistillery.getStageSpr(var)
    obj:setSprite(sprName)
    obj:getSprite():setName(sprName)
    obj:getContainer():setDrawDirty(true)
end

function MoonshineDistillery.setSprite(obj, sprName)
    obj:setSprite(sprName)
    obj:getSprite():setName(sprName)
    obj:getContainer():setDrawDirty(true)
end


function MoonshineDistillery.getState(sprName)
    local tab = {
        ["MoonshineDistillery_0"] = "empty",
        ["MoonshineDistillery_1"] = "water",
        ["MoonshineDistillery_2"] = "mash",
        ["MoonshineDistillery_3"] = "unfermented",
        ["MoonshineDistillery_4"] = "cooking",
    }
    return tab[sprName]
end

function getTimeStamp()
    return getGameTime():getWorldAgeHours()
end

local curTime = getTimeStamp()
local cooldown = 48
if not modData.LoggedTimeStamp or (curTime - modData.LoggedTimeStamp >= cooldown) then
end

function DeathSwap.getTimeStamp()
    local dateTable = os.date("*t")
    local timestamp = string.format("02d02d02d",
        dateTable.year, dateTable.month, dateTable.day,
        dateTable.hour, dateTable.min, dateTable.sec)
    return timestamp
end

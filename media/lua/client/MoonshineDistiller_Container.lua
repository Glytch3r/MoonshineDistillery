--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]



MoonshineDistillery = MoonshineDistillery or {}




-----------------------            ---------------------------
function MoonshineDistillery.getDrainPortObj(obj)

   local spr = obj:getSprite()
   local sprName = spr and spr:getName() or nil
   local sq = obj:getSquare();

   local offset = {
      ["MoonshineDistillery_16"] = {1, -1}, -- DrainPort at (x+1, y-1)
      ["MoonshineDistillery_27"] = {-1, 1}  -- DrainPort at (x-1, y+1)
   }

   local dx, dy = offset[sprName] and table.unpack(offset[sprName]) or nil
   if not dx then return nil end

   local sq2 = getCell():getGridSquare(sq:getX() + dx, sq:getY() + dy, sq:getZ())
   if not sq2 then return nil end

   for i = 0, sq2:getObjects():size() - 1 do
      local obj2 = sq2:getObjects():get(i)
      local spr2 = obj2:getSprite()
      local sprName2 = spr2 and spr2:getName() or nil
      if sprName2 == "MoonshineDistillery_22" or sprName2 == "MoonshineDistillery_30" then
         return obj2
      end
   end

   return nil
end


function MoonshineDistillery.isCompleteParts(obj)
   if not obj then return false end
   local spr = obj:getSprite()
   local sprName
   if spr then
      sprName =  spr:getName()
   end
   if not sprName then return false end
   if not MoonshineDistillery.isBoilerTile(sprName) then return false end

   local offsets = {
      ["MoonshineDistillery_16"] = {
         {0, 0, "MoonshineDistillery_20"}, -- StillCap
         {0, 0, "MoonshineDistillery_21"}, -- Thermometer
         {1, -1, "MoonshineDistillery_22"} -- DrainPort

         {1, 0, "MoonshineDistillery_17"}, -- thumper tall
         {1, -1, "MoonshineDistillery_18"}, -- thumper short
         {1, -1, "MoonshineDistillery_19"}, -- can
      },
      ["MoonshineDistillery_27"] = {
         {0, 0, "MoonshineDistillery_28"}, -- StillCap
         {0, 0, "MoonshineDistillery_29"}, -- Thermometer
         {-1, 1, "MoonshineDistillery_30"} -- DrainPort

         {0, 1, "MoonshineDistillery_26"}, -- thumper tall
         {-1, 1, "MoonshineDistillery_25"}, -- thumper short
         {-1, 1, "MoonshineDistillery_24"}, -- can
      }
   }

   local parts = offsets[sprName]
   if not parts then return false end

   local sq = obj:getSquare()
   if not sq then return false end

   for i = 1, #parts do
      local px, py, targSpr = unpack(parts[i])
      local sq2 = getCell():getGridSquare(sq:getX() + px, sq:getY() + py, sq:getZ())
      if not sq2 then return false end

      local check = false
      for j = 0, sq2:getObjects():size() - 1 do
         if sq2:getObjects():get(j):getSprite():getName() == targSpr then
            check = true
            break
         end
      end

      if not check then return false end
   end

   return true
end

--[[



local count = 0
local rad = 4
local pl = getPlayer()
local cell = pl:getCell()
local x, y, z = pl:getX(), pl:getY(), pl:getZ()
for xDelta = -rad, rad do
	for yDelta = -rad, rad do
		local sq = cell:getOrCreateGridSquare(x + xDelta, y + yDelta, z)
		for i=0, sq:getObjects():size()-1 do
			local obj = sq:getObjects():get(i)
			local water = obj:getModData()['waterAmount'] or obj:getWaterAmount()
			local tainted = obj:getModData()['taintedWater']
			tainted water
		end
	end
end
 ]]
--(2 * rad + 1) ^ 2



--[[
function MoonshineDistillery.isCompleteParts(sq)
    if not sq then return false end
    local spr = sq:getSpriteName()

    local offsets = {
        ["MoonshineDistillery_16"] = {
            {0, 0, "MoonshineDistillery_20"}, -- StillCap
            {0, 0, "MoonshineDistillery_21"}, -- Thermometer
            {1, -1, "MoonshineDistillery_22"} -- DrainPort
        },
        ["MoonshineDistillery_27"] = {
            {0, 0, "MoonshineDistillery_28"}, -- StillCap
            {0, 0, "MoonshineDistillery_29"}, -- Thermometer
            {-1, 1, "MoonshineDistillery_30"} -- DrainPort
        }
    }

    local parts = offsets[spr]
    if not parts then return false end

    for _, part in ipairs(parts) do
        local px, py, expectedSpr = table.unpack(part)
        local partSquare = getCell():getGridSquare(sq:getX() + px, sq:getY() + py, sq:getZ())
        if not partSquare then return false end

        local found = false
        for i = 0, partSquare:getObjects():size() - 1 do
            if partSquare:getObjects():get(i):getSpriteName() == expectedSpr then
                found = true
                break
            end
        end

        if not found then return false end
    end

    return true
end
 ]]
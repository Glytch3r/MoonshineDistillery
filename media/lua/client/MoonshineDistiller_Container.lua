--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]



MoonshineDistillery = MoonshineDistillery or {}




-----------------------            ---------------------------
function MoonshineDistillery.getDrainPortObj(obj)
    if not obj then return nil end

    local spr = obj:getSprite()
    if not spr then return nil end

    local sprName = spr:getName()
    if not sprName then return nil end

    local sq = obj:getSquare()
    if not sq then return nil end

    local offset = {
        ["MoonshineDistillery_16"] = {1, -1},
        ["MoonshineDistillery_27"] = {-1, 1}
    }
    local dx, dy = unpack(offset[sprName] or {})
    if not dx or not dy then return nil end
    local sq2 = getCell():getGridSquare(sq:getX() + dx, sq:getY() + dy, sq:getZ())
    if not sq2 then return nil end

    for i = 0, sq2:getObjects():size() - 1 do
        local obj2 = sq2:getObjects():get(i)
        local spr2 = obj2:getSprite()
        local sprName2 = spr2 and spr2:getName() or nil
        if sprName2 == "MoonshineDistillery_22" or sprName2 == "MoonshineDistillery_30" then
            return obj2
        end
    end

    return nil
end



function MoonshineDistillery.isCompleteParts(obj, checkThermometer)
    if not obj then return false end
    local spr = obj:getSprite()
    local sprName
    if spr then
        sprName =  spr:getName()
    end
    if not sprName then return false end
    if not MoonshineDistillery.isBoilerTile(sprName) then return false end
    local offsets = {
        ["MoonshineDistillery_16"] = { -- boiler
            {0, 0, "MoonshineDistillery_20"}, -- StillCap
            --{0, 0, "MoonshineDistillery_21"}, -- Thermometer
            {1, -1, "MoonshineDistillery_22"}, -- DrainPort
            {1, 0, "MoonshineDistillery_17"}, -- thumper tall
            {1, -1, "MoonshineDistillery_18"}, -- thumper short
            {1, -1, "MoonshineDistillery_19"}, -- can
        },
        ["MoonshineDistillery_27"] = { -- boiler
            {0, 0, "MoonshineDistillery_28"}, -- StillCap
            --{0, 0, "MoonshineDistillery_29"}, -- Thermometer
            {-1, 1, "MoonshineDistillery_30"}, -- DrainPort
            {0, 1, "MoonshineDistillery_26"}, -- thumper tall
            {-1, 1, "MoonshineDistillery_25"}, -- thumper short
            {-1, 1, "MoonshineDistillery_24"}, -- can
        }
    }

    if checkThermometer then
        offsets = {
            ["MoonshineDistillery_16"] = { -- boiler
                {0, 0, "MoonshineDistillery_20"}, -- StillCap
                {0, 0, "MoonshineDistillery_21"}, -- Thermometer
                {1, -1, "MoonshineDistillery_22"}, -- DrainPort
                {1, 0, "MoonshineDistillery_17"}, -- thumper tall
                {1, -1, "MoonshineDistillery_18"}, -- thumper short
                {1, -1, "MoonshineDistillery_19"}, -- can
            },
            ["MoonshineDistillery_27"] = { -- boiler
                {0, 0, "MoonshineDistillery_28"}, -- StillCap
                {0, 0, "MoonshineDistillery_29"}, -- Thermometer
                {-1, 1, "MoonshineDistillery_30"}, -- DrainPort
                {0, 1, "MoonshineDistillery_26"}, -- thumper tall
                {-1, 1, "MoonshineDistillery_25"}, -- thumper short
                {-1, 1, "MoonshineDistillery_24"}, -- can
            }
        }
    end
    local parts = offsets[sprName]
    if not parts then return false end

    local sq = obj:getSquare()
    if not sq then return false end

    for i = 1, #parts do
        local px, py, targSpr = unpack(parts[i])
        local sq2 = getCell():getGridSquare(sq:getX() + px, sq:getY() + py, sq:getZ())
        if not sq2 then return false end

        local check = false
        for j = 0, sq2:getObjects():size() - 1 do
            if sq2:getObjects():get(j):getSprite():getName() == targSpr then
                check = true
                break
            end
        end

        if not check then return false end
    end

    return true
end

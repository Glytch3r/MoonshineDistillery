--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]

MoonshineDistillery = MoonshineDistillery or {}

function MoonshineDistillery.loadCursor()
    ISMoonshineTileCursor = ISBuildingObject:derive("ISMoonshineTileCursor")

    function ISMoonshineTileCursor:create(x, y, z, firstSq)
        local pl = getPlayer()
        local spr = self.spr
        firstSq = firstSq or self.firstSq
        local err = false

        local positions = {}
        if spr == "MoonshineDistillery_16" then
            positions = {
                {x, y, z, "MoonshineDistillery_16"}, --boiler
                {x + 1, y, z, "MoonshineDistillery_17"}, -- thumper tall
                {x + 1, y - 1, z, "MoonshineDistillery_18"}, -- thumper short
                {x + 1, y - 1, z, "MoonshineDistillery_19"}, -- can
                --{x + 1, y - 1, z, "MoonshineDistillery_19"}, -- DrainPort

            }
        elseif spr == "MoonshineDistillery_27" then
            positions = {
                {x, y, z, "MoonshineDistillery_27"}, --boiler
                {x, y + 1, z, "MoonshineDistillery_26"}, -- thumper tall
                {x - 1, y + 1, z, "MoonshineDistillery_25"}, -- thumper short
                {x - 1, y + 1, z, "MoonshineDistillery_24"}, -- can
                --{x - 1, y + 1, z, "MoonshineDistillery_30"} -- DrainPort
            }
        end
        self.positions = positions
        local firstSq = getCell():getOrCreateGridSquare(x, y, z)
        if not MoonshineDistillery.checkDist(pl, firstSq) then
            pl:setHaloNote("Need to get closer", 150, 250, 150, 900)
            err = true
        end

        for _, pos in ipairs(positions) do
            local square = getCell():getGridSquare(pos[1], pos[2], pos[3])
            if not (square or square:isFree(false)) then
                pl:setHaloNote("Cannot place there", 150, 250, 150, 900)
                err = true
            end
            local flr = square:getFloor()
            if flr then
                flr:setHighlighted(true, true);
            end
        end

        if not err then
            if not MoonshineDistillery.delBuildItems(pl) then
                pl:setHaloNote(tostring("Failed to build Moonshine Disiller"), 250,250,250,900)
                return
            end
        end
        for _, pos in ipairs(positions) do
            local square = getCell():getGridSquare(pos[1], pos[2], pos[3])
            if square then
                local props = ISMoveableSpriteProps.new(IsoObject.new(square, pos[4]):getSprite())
                props.rawWeight = 10
                props:placeMoveableInternal(square, InventoryItemFactory.CreateItem("Base.Plank"), pos[4])
                addSound(pl, square:getX(), square:getY(), square:getZ(), 5, 1)
                getSoundManager():PlayWorldSound('MoonshineBuild', square, 0, 5, 5, false)
            end
        end
        ISMoveableCursor.clearCacheForAllPlayers();
    end


    function ISMoonshineTileCursor:rotateKey(key)
        if key == getCore():getKey("Rotate building") then
            if self.spr	 == "MoonshineDistillery_16" then
                self.spr = "MoonshineDistillery_27"
            else
                self.spr = "MoonshineDistillery_16"
            end


            --self.RENDER_SPRITE_NAME = self.spr
           -- self.RENDER_SPRITE:LoadFramesNoDirPageSimple(self.spr)
--[[
            if self:isValid(square) then
                self.RENDER_SPRITE:RenderGhostTile(x, y, z);
            else
                self.RENDER_SPRITE:RenderGhostTileRed(x, y, z);
            end ]]

            local cursor = ISMoonshineTileCursor:new(self.spr,  getPlayer() , square)
            getCell():setDrag(cursor, 0)
            ISMoveableCursor.clearCacheForAllPlayers();
            return
        end
    end

    function ISMoonshineTileCursor:render(x, y, z, square)


        ISBuildingObject.render(self, x, y, z, square)
    end

    function ISMoonshineTileCursor:new(spr, character, firstSq)
        local o = setmetatable({}, self)
        self.__index = self
        o:init()
        o:setSprite(spr)

        o:setNorthSprite(spr2)

        o.spr = spr
        o.firstSq = firstSq
        o.square = firstSq
        o.character = character
        o.player = character:getPlayerNum()
        o.isTileCursor = true
        o.spriteName = spr
        o.noNeedHammer = true
        o.skipBuildAction = false
        o.skipWalk2 = false
        o.canBeAlwaysPlaced = true
        o.cd = false
        o.ticks = 0



        return o
    end
end

Events.OnCreatePlayer.Add(function()
    MoonshineDistillery.loadCursor()
end)

--[[

   MoonshineDistillery.loadCursor()

]]






